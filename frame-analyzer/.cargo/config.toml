[build]
# 安卓ARM64目标，与项目支持的架构匹配
target = "aarch64-linux-android"
# 统一输出到项目根目录target，方便跨模块调用
target-dir = "../../target"
# 禁用增量编译，避免安卓交叉编译缓存异常
incremental = false

[target.aarch64-linux-android]
# 用环境变量引用NDK路径，适配容器/不同安装位置
linker = "$ANDROID_NDK_ROOT/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android33-clang"
ar = "$ANDROID_NDK_ROOT/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android-ar"

rustflags = [
    # 动态引用NDK库搜索路径
    "-L", "$ANDROID_NDK_ROOT/toolchains/llvm/prebuilt/linux-x86_64/sysroot/usr/lib/aarch64-linux-android/33",
    "-l", "log",          # 链接安卓日志库
    "-l", "c++_static",   # 替代libunwind（NDK r25c整合到c++库）
    "-C", "link-arg=-fuse-ld=lld",  # 使用LLD链接器加速编译
    "-C", "target-feature=+v8a",    # 启用ARMv8-A特性
    "-C", "link-arg=-pie",           # 启用PIE，符合安卓7.0+安全要求
    "-C", "opt-level=s",             # 优化安卓二进制体积
]

[env]
# 仅声明环境变量，由用户在系统/容器中设置实际值
ANDROID_NDK_ROOT = { value = "", force = false }
# 优先系统Cargo工具链，再NDK工具链
PATH = { value = "$HOME/.cargo/bin:$ANDROID_NDK_ROOT/toolchains/llvm/prebuilt/linux-x86_64/bin:$PATH", force = true }
# 强制使用nightly工具链，与eBPF模块保持一致
RUSTUP_TOOLCHAIN = "nightly"
